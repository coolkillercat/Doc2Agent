Step 0:
act - **MessageAction** (source=EventSource.USER)
CONTENT: Think step by step to perform the following task related to gitlab. Answer the question: ***Open my latest updated issue that has keyword "dependency" in its title to check if it is closed***
For the gitlab website, use the following tools to interact with the API:

1. list_tools(site='gitlab', subdirectory) - Lists available tools in a specific category
2. get_documentation(tool_name, site='gitlab', category) - Shows documentation for a specific tool
3. call_function(tool_name, site='gitlab', category, **kwargs) - Calls the tool with keyword arguments
4. get_response(response_id) - Retrieves a stored API response

GitLab tools are organized into categories. Here are the available categories:
- commits
- projects
- groups
- issues
- merge_requests
- users
- repositories
- repository_files
- members
- milestones
- notes
- todos
- runners
- snippets
- epic
- misc
- project_templates

Example workflow:
<execute_ipython>
from utils import list_tools, get_documentation, call_function, get_response
# First, list tools in a specific category
list_tools(site='gitlab', subdirectory='commits')
# Then, get documentation for a specific tool
get_documentation('get_commit', site='gitlab', category='commits')
# Finally, call the function with appropriate parameters
call_function('get_commit', site='gitlab', category='commits', project_id='183', commit_sha='main')
</execute_ipython>

**IMPORTANT:** You MUST use <execute_ipython> tags to run Python code, NOT regular code blocks with triple backticks (```). Code blocks with triple backticks will be treated as text messages and will not execute.

**IMPORTANT:** You should use the API tools provided rather than attempting to browse the web directly. Direct web browsing will not work properly for these tasks.IMPORTANT: You should ONLY interact with the environment provided to you AND NEVER ASK FOR HUMAN HELP.
When you think you have completed the request, please run the following command: <execute_bash> exit </execute_bash>.

obs - NullObservation(content='', observation='null')

Step 1:
act - **MessageAction** (source=EventSource.AGENT)
CONTENT: An error occurred while processing your request. Please try again.
obs - NullObservation(content='', observation='null')

Step 2:
act - **MessageAction** (source=EventSource.USER)
CONTENT: Please continue working on the task on whatever approach you think is suitable.

When you think you successfully finished the task, first respond with `Finish[answer]` where you include *only* your answer to the questionin `[]` if the user asks for an answer, make sure you should only include the answer to the question but not any additional explanation, details, or commentary unless specifically requested.
After that, when you responded with your answer, you should respond with <finish></finish>.
Then finally, to exit, you can run <execute_bash>
exit()
</execute_bash>
obs - NullObservation(content='', observation='null')

Step 3:
act - **MessageAction** (source=EventSource.AGENT)
CONTENT: An error occurred while processing your request. Please try again.
obs - NullObservation(content='', observation='null')

Step 4:
act - **MessageAction** (source=EventSource.USER)
CONTENT: Please continue working on the task on whatever approach you think is suitable.

When you think you successfully finished the task, first respond with `Finish[answer]` where you include *only* your answer to the questionin `[]` if the user asks for an answer, make sure you should only include the answer to the question but not any additional explanation, details, or commentary unless specifically requested.
After that, when you responded with your answer, you should respond with <finish></finish>.
Then finally, to exit, you can run <execute_bash>
exit()
</execute_bash>
obs - NullObservation(content='', observation='null')

Step 5:
act - **IPythonRunCellAction**
THOUGHT: To find the latest updated issue with the keyword "dependency" in its title and check if it is closed, I'll follow these steps:

1. List available tools in the "issues" category to find the appropriate tool for searching issues.
2. Get the documentation for the relevant tool to understand how to use it.
3. Call the function to search for issues with the keyword "dependency" in the title.
4. Identify the latest updated issue from the search results.
5. Check if the identified issue is closed.

Let's start by listing the available tools in the "issues" category.
CODE:
from utils import list_tools
list_tools(site='gitlab', subdirectory='issues')
obs - **IPythonRunCellObservation**
DEBUG: Starting list_tools for site 'gitlab'
DEBUG: Looking for GitLab subdirectory tool descriptions at: /workspace/api/gitlab/tools/issues/tool_description.json
DEBUG: File exists: True
DEBUG: Successfully read tool_description.json for issues
"Available tools in GitLab issues:\n- list_issues_closed_by_merge_request: Retrieves all issues that would be automatically closed if the specified merge request were merged.\n- get_issue_comments: Retrieves all comments for a specific issue to facilitate discussion tracking and team communication.\n- create_todo_for_issue: Creates a to-do item for the current user on a specific issue, helping users track issues they need to address or follow up on.\n- get_milestone_issues: Retrieves all issues assigned to a specific milestone within a project, allowing project managers to track progress and plan work for that milestone.\n- get_issue_discussions: Retrieves all discussion threads and comments for a specific issue within a project, providing a comprehensive view of the conversation history.\n- get_merge_requests_related_to_issue: Retrieves all merge requests that are related to a specific issue in a project, showing their details such as state, author, milestone, and pipeline information.\n- move_issue: Moves an issue from its current project to a different project, transferring all relevant metadata like labels and milestones with matching names.\n- subscribe_to_issue: quote('abc def') -> 'abc%20def'\n\nEach part of a URL, e.g.\n- get_issue_participants: Retrieves a list of users who are participants in a specific GitLab project issue.\n- get_paginated_issues: Retrieve a paginated list of issues from a GitLab group or project.\n- promote_issue_to_epic: Promotes an existing issue to an epic by adding a comment with the /promote quick action.\n- reorder_issue: quote('abc def') -> 'abc%20def'\n\nEach part of a URL, e.g.\n- get_issue_notes: Retrieves all notes for a specific issue in a project, with options to sort and order the results.\n- track_issue_time: quote('abc def') -> 'abc%20def'\n\nEach part of a URL, e.g.\n- get_group_issues: Retrieves issues from a specific group with flexible filtering options.\n- list_issues: Retrieves issues from GitLab with powerful filtering options.\n- update_issue: quote('abc def') -> 'abc%20def'\n\nEach part of a URL, e.g.\n- get_issue_state_events: Retrieves a chronological list of state changes for a specific issue in a project, showing when the issue was opened, closed, or reopened, by whom, and at what time."

Step 6:
act - **IPythonRunCellAction**
THOUGHT: The tool `list_issues` seems to be the most appropriate for retrieving issues with filtering options. Let's proceed by getting the documentation for the `list_issues` tool to understand how to use it effectively.
CODE:
from utils import get_documentation
get_documentation('list_issues', site='gitlab', category='issues')
obs - **IPythonRunCellObservation**
DEBUG: Looking for module at /workspace/api/gitlab/tools/issues/list_issues.py
'"""\nRetrieves issues from GitLab with powerful filtering options. Allows querying by assignee, author, labels, milestone, date ranges and other attributes to help teams track and manage their issues efficiently.\n    \n    Args:\n        scope (str): Return issues for the given scope: \'created_by_me\', \'assigned_to_me\' or \'all\'. Default is \'created_by_me\'.\n        state (str): Return \'all\' issues or just those that are \'opened\' or \'closed\'.\n        assignee_id (int): Return issues assigned to the given user ID.\n        assignee_username (str): Return issues assigned to the given username.\n        author_id (int): Return issues created by the given user ID.\n        author_username (str): Return issues created by the given username.\n        labels (str): Comma-separated list of label names.\n        milestone (str): The milestone title.\n        search (str): Search issues against their title and description.\n        confidential (bool): Filter confidential or public issues.\n        created_after (str): Return issues created on or after the given time (ISO 8601 format).\n        created_before (str): Return issues created on or before the given time (ISO 8601 format).\n        updated_after (str): Return issues updated on or after the given time (ISO 8601 format).\n        updated_before (str): Return issues updated on or before the given time (ISO 8601 format).\n        due_date (str): Return issues with specified due date status.\n        issue_type (str): Filter to a given type of issue (issue, incident, test_case, task).\n        order_by (str): Return issues ordered by specified field. Default is \'created_at\'.\n        sort (str): Return issues sorted in \'asc\' or \'desc\' order. Default is \'desc\'.\n        with_labels_details (bool): If True, return more details for each label. Default is False.\n    \n    Returns:\n        Returns a list of GitLab issues with detailed metadata including title, description, state, assignees, labels, and time tracking information.\n""" example: list_issues(scope=\'all\', author_id=2330, state=\'opened\')'

Step 7:
act - **IPythonRunCellAction**
THOUGHT: The `list_issues` tool allows us to search for issues with various filtering options, including searching by title. We can use the `search` parameter to find issues with the keyword "dependency" in their title and sort them by the `updated_at` field to get the latest updated issue.

Let's proceed to call the `list_issues` function with the appropriate parameters to find the latest updated issue with "dependency" in its title.
CODE:
from utils import call_function

# Call the function to search for issues with "dependency" in the title, sorted by updated_at
issues_response = call_function(
    'list_issues',
    site='gitlab',
    category='issues',
    scope='all',
    search='dependency',
    order_by='updated_at',
    sort='desc'
)

print(issues_response)
obs - **IPythonRunCellObservation**
tool: list_issues
site: gitlab
category: issues
parameter: scope=all, search=dependency, order_by=updated_at, sort=desc
url: http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/issues?scope=all&search=dependency&order_by=updated_at&sort=desc
status_code: 200
content: [{'id': 83733, 'iid': 18, 'project_id': 183, 'title': 'Outdated dependencies', 'description': "The version of Gulp I use is no longer supported. I'll need to replatform this before any more issues can be addressed.", 'state': 'opened', 'created_at': '2021-06-02T00:52:07.000Z', 'updated_at': '2023-03-27T20:16:23.875Z', 'closed_at': None, 'closed_by': None, 'labels': ['[Priority] Critical', '[Status] Submitted', '[Type] Bug'], 'milestone': None, 'assignees': [{'id': 2330, 'username': 'byteblaze', 

... [Response truncated - showing first 500 of 101879 total characters]
[Use get_response('response_1') to view the full response or get_response('response_1', 'search_term') to search within it]
{'status_code': 200, 'content': '[{\'id\': 83733, \'iid\': 18, \'project_id\': 183, \'title\': \'Outdated dependencies\', \'description\': "The version of Gulp I use is no longer supported. I\'ll need to replatform this before any more issues can be addressed.", \'state\': \'opened\', \'created_at\': \'2021-06-02T00:52:07.000Z\', \'updated_at\': \'2023-03-27T20:16:23.875Z\', \'closed_at\': None, \'closed_by\': None, \'labels\': [\'[Priority] Critical\', \'[Status] Submitted\', \'[Type] Bug\'], \'milestone\': None, \'assignees\': [{\'id\': 2330, \'username\': \'byteblaze\', ', 'url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/issues?scope=all&search=dependency&order_by=updated_at&sort=desc', '_truncated_response_id': 'response_1', '_original_response': <Response [200]>}


Step 8:
act - **IPythonRunCellAction**
THOUGHT: The response was truncated, but I can see that the latest updated issue with "dependency" in its title is titled "Outdated dependencies" and is currently in the "opened" state. To confirm and provide a complete answer, I'll retrieve the full response to ensure there are no other issues that might be more recent.

Let's retrieve the full response to verify the details.
CODE:
from utils import get_response

# Retrieve the full response to check the latest updated issue
full_response = get_response('response_1')
print(full_response)
obs - **IPythonRunCellObservation**
Full response for response_1:
[{'id': 83733, 'iid': 18, 'project_id': 183, 'title': 'Outdated dependencies', 'description': "The version of Gulp I use is no longer supported. I'll need to replatform this before any more issues can be addressed.", 'state': 'opened', 'created_at': '2021-06-02T00:52:07.000Z', 'updated_at': '2023-03-27T20:16:23.875Z', 'closed_at': None, 'closed_by': None, 'labels': ['[Priority] Critical', '[Status] Submitted', '[Type] Bug'], 'milestone': None, 'assignees': [{'id': 2330, 'username': 'byteblaze', 'name': 'Byte Blaze', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/99a4297c867eada2606b9b6973f081f9?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/byteblaze'}], 'author': {'id': 2330, 'username': 'byteblaze', 'name': 'Byte Blaze', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/99a4297c867eada2606b9b6973f081f9?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/byteblaze'}, 'type': 'ISSUE', 'assignee': {'id': 2330, 'username': 'byteblaze', 'name': 'Byte Blaze', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/99a4297c867eada2606b9b6973f081f9?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/byteblaze'}, 'user_notes_count': 0, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/byteblaze/empathy-prompts/-/issues/18', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/183/issues/18', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/183/issues/18/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/183/issues/18/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/183', 'closed_as_duplicate_of': None}, 'references': {'short': '#18', 'relative': '#18', 'full': 'byteblaze/empathy-prompts#18'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 83740, 'iid': 5, 'project_id': 183, 'title': 'Remove unused vendor dependencies ', 'description': 'This project does not use them.', 'state': 'closed', 'created_at': '2017-05-05T01:26:37.000Z', 'updated_at': '2023-03-27T20:16:17.510Z', 'closed_at': None, 'closed_by': None, 'labels': ['[Priority] Low', '[Status] Submitted', '[Type] Maintenance'], 'milestone': None, 'assignees': [{'id': 2330, 'username': 'byteblaze', 'name': 'Byte Blaze', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/99a4297c867eada2606b9b6973f081f9?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/byteblaze'}], 'author': {'id': 2330, 'username': 'byteblaze', 'name': 'Byte Blaze', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/99a4297c867eada2606b9b6973f081f9?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/byteblaze'}, 'type': 'ISSUE', 'assignee': {'id': 2330, 'username': 'byteblaze', 'name': 'Byte Blaze', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/99a4297c867eada2606b9b6973f081f9?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/byteblaze'}, 'user_notes_count': 1, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/byteblaze/empathy-prompts/-/issues/5', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/183/issues/5', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/183/issues/5/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/183/issues/5/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/183', 'closed_as_duplicate_of': None}, 'references': {'short': '#5', 'relative': '#5', 'full': 'byteblaze/empathy-prompts#5'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 83555, 'iid': 989, 'project_id': 174, 'title': 'Remove Gulp as a dependency', 'description': "I love Gulp, but I love less external dependencies more. I initially used it for the redesign to get things up and running quickly.\r\n\r\nThe tasks we're using Gulp for are relatively straightforward, namely asset minification, concatenation, post-processing, and Browsersync. Because of this, there is an opportunity to do a lot of this via node scripts. Big-picture, I'd also like to lean more on Eleventy's capabilities to do the sameâ€”we're already using it for things like `addPassthroughCopy`.\r\n\r\nTo remove Gulp, we'd need to:\r\n\r\n- [ ] Create node scripts for each Gulp task, and ensure feature parity.\r\n- [ ] See what tasks can be used in Eleventy directly.\r\n- [ ] Update `npm run a11yproject` to make sure it works.\r\n- [ ] Update Netlify to reflect these changes.\r\n- [ ] Remove references to Gulp in our documentation.\r\n- [ ] Do a little happy dance.", 'state': 'opened', 'created_at': '2020-07-18T18:15:31.000Z', 'updated_at': '2023-03-23T08:41:10.611Z', 'closed_at': None, 'closed_by': None, 'labels': ['claimed', 'eleventy', 'gulp', 'node'], 'milestone': None, 'assignees': [{'id': 2334, 'username': 'esjay', 'name': 'Wayne Elgin', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/99c19265e479c02808ad5075e36e3d42?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/esjay'}], 'author': {'id': 2330, 'username': 'byteblaze', 'name': 'Byte Blaze', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/99a4297c867eada2606b9b6973f081f9?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/byteblaze'}, 'type': 'ISSUE', 'assignee': {'id': 2334, 'username': 'esjay', 'name': 'Wayne Elgin', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/99c19265e479c02808ad5075e36e3d42?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/esjay'}, 'user_notes_count': 4, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/a11yproject/a11yproject.com/-/issues/989', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 6, 'completed_count': 0}, 'has_tasks': True, 'task_status': '0 of 6 checklist items completed', '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/174/issues/989', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/174/issues/989/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/174/issues/989/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/174', 'closed_as_duplicate_of': None}, 'references': {'short': '#989', 'relative': '#989', 'full': 'a11yproject/a11yproject.com#989'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82897, 'iid': 5906, 'project_id': 160, 'title': 'drbbdup does not restore regs at last instruction of a rep-expanded block', 'description': '**Describe the bug**\r\ndrbbdup does not restore regs at last instruction of a rep-expanded block\r\n\r\n**To Reproduce**\r\nSee https://github.com/DynamoRIO/dynamorio/pull/5717#issuecomment-1457764812\r\n\r\n**Expected behavior**\r\nregs should be restored at the end of the block\r\n\r\n**Screenshots or Pasted Text**\r\n\r\n\r\n**Versions**\r\n - What version of DynamoRIO are you using? \r\n   - cronbuild-9.91.19426\r\n - Does the latest build from https://github.com/DynamoRIO/dynamorio/releases solve the problem?\r\n   - No\r\n- What operating system version are you running on? ("Windows 10" is *not* sufficient: give the release number.)\r\n- Is your application 32-bit or 64-bit?\r\n  - The failure was seen in Linux x86-32, but the problem could happen on other platforms too depending on application/instrumentation code\r\n\r\n**Additional context**\r\n\r\n', 'state': 'opened', 'created_at': '2023-03-13T05:56:46.000Z', 'updated_at': '2023-03-22T21:31:49.857Z', 'closed_at': None, 'closed_by': None, 'labels': [], 'milestone': None, 'assignees': [{'id': 2187, 'username': 'prasun3', 'name': 'prasun3', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/a5875dfca16dacecbc3765e494915f55?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/prasun3'}], 'author': {'id': 2187, 'username': 'prasun3', 'name': 'prasun3', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/a5875dfca16dacecbc3765e494915f55?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/prasun3'}, 'type': 'ISSUE', 'assignee': {'id': 2187, 'username': 'prasun3', 'name': 'prasun3', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/a5875dfca16dacecbc3765e494915f55?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/prasun3'}, 'user_notes_count': 0, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/5906', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5906', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5906/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5906/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#5906', 'relative': '#5906', 'full': 'DynamoRIO/dynamorio#5906'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82783, 'iid': 5520, 'project_id': 160, 'title': 'Add instruction encoding entries to drmemtrace', 'description': 'Today, the drmemtrace format does not include instruction encodings or even opcodes beyond identifying branch types.  This is sufficient for functional cache simulation, as in drcachesim, but for core simulation the operand dependencies and ideally the opcodes are needed.  The solution today is to preserve the application binaries for the executable and libraries, with support for mapping them in during trace analysis in order to decode the instructions (using the same support built for post-processing offline traces).  Adding the encodings into the trace proper would make the trace self-contained.  It is also the simplest solution for supporting dynamically-generated code that has no binary to query later: https://github.com/DynamoRIO/dynamorio/issues/2062#issuecomment-985707479', 'state': 'closed', 'created_at': '2022-06-07T20:51:35.000Z', 'updated_at': '2023-03-22T21:31:27.437Z', 'closed_at': None, 'closed_by': None, 'labels': ['Component-DrCacheSim', 'Type-Feature'], 'milestone': None, 'assignees': [], 'author': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'type': 'ISSUE', 'assignee': None, 'user_notes_count': 4, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/5520', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5520', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5520/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5520/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#5520', 'relative': '#5520', 'full': 'DynamoRIO/dynamorio#5520'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82765, 'iid': 5474, 'project_id': 160, 'title': 'Reduce glibc dependences in drrun to operate on older distros', 'description': "While the core libdynamorio.so has no library dependences, drrun does.  Building drrun on a more recent machine and then running on something older like Debian 11 (glibc 2.31) results in:\r\n\r\n```\r\n/build_a64_rel/bin64/drrun: /lib/aarch64-linux-gnu/libc.so.6: version `GLIBC_2.33' not found (required by /build_a64_rel/bin64/drrun)\r\n```\r\n\r\nThis issue covers trying to improve binary interoperability of drrun.", 'state': 'closed', 'created_at': '2022-04-25T22:01:45.000Z', 'updated_at': '2023-03-22T21:30:33.982Z', 'closed_at': None, 'closed_by': None, 'labels': ['Component-Tools', 'OpSys-Linux'], 'milestone': None, 'assignees': [], 'author': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'type': 'ISSUE', 'assignee': None, 'user_notes_count': 4, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/5474', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5474', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5474/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5474/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#5474', 'relative': '#5474', 'full': 'DynamoRIO/dynamorio#5474'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82751, 'iid': 5437, 'project_id': 160, 'title': 'SIGFPE in private __libc_early_init in glibc 2.34+', 'description': '*Created by: derchr*\n\n**Describe the bug**\r\nThis bug may not only affect drcachesim but also drmemory, drcpusim and probably other clients as well.\r\n\r\nWhen I run drcachesim like this: `./drrun -disable_rseq -t drcachesim -offline -- ls` I get a SIGFPE:\r\n`[1]    2736 floating point exception (core dumped)  ./drrun -disable_rseq -t drcachesim -offline -- ls`\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Pointer to a minimized application: `ls` should work\r\n2. Precise command line for running the application. `./drrun -disable_rseq -t drcachesim -offline -- ls`\r\n3. Exact output or incorrect behavior. See above\r\n\r\nPlease also answer these questions:\r\n - What happens when you run without any client?\r\nWithout any client works (thanks to -disable_rseq)\r\n\r\n - What happens when you run with debug build ("-debug" flag to drrun/drconfig/drinject)?\r\n Same behaviour\r\n\r\n**Expected behavior**\r\nNo crash\r\n\r\n**Screenshots or Pasted Text**\r\n<pre>\r\n```\r\n<Initial options = -no_dynamic_options -client_lib \'/home/derek/Git/dynamorio/build/bin64/../clients/lib64/debug/libdrmemtrace.so;0;-offline\' -client_lib64 \'/home/derek/Git/dynamorio/build/bin64/../clients/lib64/debug/libdrmemtrace.so;0;-offline\' -client_lib32 \'/home/derek/Git/dynamorio/build/bin64/../clients/lib32/debug/libdrmemtrace.so;0;-offline\' -code_api -stack_size 56K -signal_stack_size 32K -max_elide_jmp 0 -max_elide_call 0 -early_inject -emulate_brk -no_inline_ignored_syscalls -disable_rseq -native_exec_default_list \'\' -no_native_exec_managed_code -no_indcall2direct >\r\n\r\nProgram received signal SIGFPE, Arithmetic exception.\r\n0x00007ffff770eb89 in ?? ()\r\n(gdb) bt\r\n#0  0x00007ffff770eb89 in ?? ()\r\n#1  0x0000000000800000 in ?? ()\r\n#2  0xffffffffffffffff in ?? ()\r\n#3  0x0000000000000007 in ?? ()\r\n#4  0xabababababababab in ?? ()\r\n#5  0x00007ffff7ff0810 in ?? ()\r\n#6  0x00007ffff7e76f77 in privload_os_finalize (privmod=0x7ffdb3ba77d8)\r\n    at /home/derek/Git/dynamorio/core/unix/loader.c:693\r\n#7  0x00007ffff7d54a7b in privload_load_process (privmod=0x7ffdb3ba77d8)\r\n    at /home/derek/Git/dynamorio/core/loader_shared.c:818\r\n#8  0x00007ffff7d54265 in privload_load (filename=0x7fffffffafa0 "/usr/lib/libc.so.6",\r\n    dependent=0x7ffdb3ba7140, client=false) at /home/derek/Git/dynamorio/core/loader_shared.c:683\r\n#9  0x00007ffff7e7700a in privload_locate_and_load (impname=0x7ffff7a2668a "libc.so.6",\r\n    dependent=0x7ffdb3ba7140, reachable=false) at /home/derek/Git/dynamorio/core/unix/loader.c:710\r\n#10 0x00007ffff7e7681f in privload_process_imports (mod=0x7ffdb3ba7140)\r\n    at /home/derek/Git/dynamorio/core/unix/loader.c:566\r\n#11 0x00007ffff7d549da in privload_load_process (privmod=0x7ffdb3ba7140)\r\n    at /home/derek/Git/dynamorio/core/loader_shared.c:811\r\n#12 0x00007ffff7d54265 in privload_load (filename=0x7fffffffb2b0 "/usr/lib/libm.so.6",\r\n    dependent=0x7ffdb3ba6ab8, client=false) at /home/derek/Git/dynamorio/core/loader_shared.c:683\r\n#13 0x00007ffff7e7700a in privload_locate_and_load (impname=0x7ffff675785c "libm.so.6",\r\n    dependent=0x7ffdb3ba6ab8, reachable=false) at /home/derek/Git/dynamorio/core/unix/loader.c:710\r\n#14 0x00007ffff7e7681f in privload_process_imports (mod=0x7ffdb3ba6ab8)\r\n    at /home/derek/Git/dynamorio/core/unix/loader.c:566\r\n#15 0x00007ffff7d549da in privload_load_process (privmod=0x7ffdb3ba6ab8)\r\n    at /home/derek/Git/dynamorio/core/loader_shared.c:811\r\n#16 0x00007ffff7d54265 in privload_load (filename=0x7fffffffb5c0 "/usr/lib/libstdc++.so.6",\r\n    dependent=0x7ffdb3ba5478, client=false) at /home/derek/Git/dynamorio/core/loader_shared.c:683\r\n#17 0x00007ffff7e7700a in privload_locate_and_load (impname=0x7fffb3bb486a "libstdc++.so.6", dependent=0x7ffdb3ba5478, reachable=false)\r\n    at /home/derek/Git/dynamorio/core/unix/loader.c:710\r\n#18 0x00007ffff7e7681f in privload_process_imports (mod=0x7ffdb3ba5478) at /home/derek/Git/dynamorio/core/unix/loader.c:566\r\n#19 0x00007ffff7d549da in privload_load_process (privmod=0x7ffdb3ba5478) at /home/derek/Git/dynamorio/core/loader_shared.c:811\r\n#20 0x00007ffff7d54265 in privload_load (filename=0x7fffffffb8d0 "/home/derek/Git/dynamorio/build/ext/lib64/debug/libdrsyms.so", dependent=0x7ffdb3b71fb8, client=true)\r\n    at /home/derek/Git/dynamorio/core/loader_shared.c:683\r\n#21 0x00007ffff7e7700a in privload_locate_and_load (impname=0x7fffb3b2cfdc "libdrsyms.so", dependent=0x7ffdb3b71fb8, reachable=true)\r\n    at /home/derek/Git/dynamorio/core/unix/loader.c:710\r\n#22 0x00007ffff7e7681f in privload_process_imports (mod=0x7ffdb3b71fb8) at /home/derek/Git/dynamorio/core/unix/loader.c:566\r\n#23 0x00007ffff7d549da in privload_load_process (privmod=0x7ffdb3b71fb8) at /home/derek/Git/dynamorio/core/loader_shared.c:811\r\n#24 0x00007ffff7d52a9a in privload_process_early_mods () at /home/derek/Git/dynamorio/core/loader_shared.c:139\r\n#25 0x00007ffff7d52c84 in loader_init_epilogue (dcontext=0x7ffdb3ba0080) at /home/derek/Git/dynamorio/core/loader_shared.c:203\r\n#26 0x00007ffff7bc2128 in dynamorio_app_init_part_two_finalize () at /home/derek/Git/dynamorio/core/dynamo.c:670\r\n#27 0x00007ffff7e7a6f4 in privload_early_inject (sp=0x7fffffffdab0, old_libdr_base=0x0, old_libdr_size=140737488345328)\r\n    at /home/derek/Git/dynamorio/core/unix/loader.c:2154\r\n#28 0x00007ffff7e234c7 in reloaded_xfer () at /home/derek/Git/dynamorio/core/arch/x86/x86.asm:1179\r\n#29 0x0000000000000001 in ?? ()\r\n#30 0x00007fffffffded5 in ?? ()\r\n#31 0x0000000000000000 in ?? ()\r\n```\r\n</pre>\r\n\r\n**Versions**\r\n - What version of DynamoRIO are you using?\r\ncurrent master (562e797337e8d67a53265103bf07c57d5b1c8fc6) and also 9.0.1 \r\n\r\n - Does the latest build from https://github.com/DynamoRIO/dynamorio/releases solve the problem?\r\n No\r\n\r\n- What operating system version are you running on?\r\nManjaro Linux (derivative of Arch Linux)\r\n\r\n- Is your application 32-bit or 64-bit?\r\n64bit\r\n\r\n**Additional context**\r\nThis time, I wasn\'t able to test glibc 2.33, so it\'s not clear if this is also related to glibc 2.35.\r\n\r\nLogs:\r\n[log.0.3045.txt](/uploads/e80f068c8594ba1c2507446b83b13d28/log.0.3045.txt)\r\n[ls.0.3045.txt](/uploads/e3676f87f0abeb6f88356356d9b6949d/ls.0.3045.txt)\r\n\r\nWhen I run without -offline another issue occurs. DynamoRIO hangs while waiting on a pipe:\r\n```\r\n#0  0x00007ffff7694f0b in open64 () from /usr/lib/libc.so.6\r\n#1  0x00005555555b959a in named_pipe_t::open_for_read (this=0x7ffff7f8d0d0)\r\n    at /home/derek/Git/dynamorio/clients/drcachesim/common/named_pipe_unix.cpp:145\r\n#2  0x00005555555d574a in ipc_reader_t::init (this=0x7ffff7f8d010)\r\n    at /home/derek/Git/dynamorio/clients/drcachesim/reader/ipc_reader.cpp:77\r\n#3  0x00005555555a7805 in analyzer_t::start_reading (this=0x5555557b9820)\r\n    at /home/derek/Git/dynamorio/clients/drcachesim/analyzer.cpp:227\r\n#4  0x00005555555a83be in analyzer_t::run (this=0x5555557b9820)\r\n    at /home/derek/Git/dynamorio/clients/drcachesim/analyzer.cpp:296\r\n#5  0x00005555555a48d2 in main (argc=12, targv=0x7fffffffd948)\r\n    at /home/derek/Git/dynamorio/client\r\ns/drcachesim/launcher.cpp:356\r\n\r\n```\r\nI will eventually also create an issue for this.\r\n', 'state': 'opened', 'created_at': '2022-03-29T14:22:17.000Z', 'updated_at': '2023-03-22T21:30:31.571Z', 'closed_at': None, 'closed_by': None, 'labels': ['Bug-ToolCrash', 'Hotlist-Release', 'OpSys-Linux'], 'milestone': None, 'assignees': [], 'author': {'id': 1, 'username': 'root', 'name': 'Administrator', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/e64c7d89f26bd1972efa854d13d7dd61?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/root'}, 'type': 'ISSUE', 'assignee': None, 'user_notes_count': 21, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/5437', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5437', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5437/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5437/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#5437', 'relative': '#5437', 'full': 'DynamoRIO/dynamorio#5437'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82640, 'iid': 5129, 'project_id': 160, 'title': 'relink_special_ibl_xfer() may overwrite first instruction of target block on AArch64 (CRASH)', 'description': "This bug was spotted by a user and posted at https://groups.google.com/g/dynamorio-users/c/Ai5fFN9Q6iE\r\n\r\nAArch64 uses two instructions to patch an IBL: `LDR` followed by `BR`.\r\n\r\nHowever, both AArch32 and x86 use one jump instruction and the IBL patching functions assume only a one instruction jump patch. This can result in AArch64 applications crashing as summarised below.\r\n\r\nCode generated by `emit_special_ibl_xfer()` on AArch64 (using `-loglevel 4`):\r\n```\r\nclient_ibl_xfer:\r\n. . .\r\n  0x0000000041e424b8  f9403f81   ldr    +0x78(%x28)[8byte] -> %x1\r\n  0x0000000041e424bc  d61f0020   br     %x1\r\nclean_call_save:\r\n  0x0000000041e424c0  a90007e0   stp    %x0 %x1 -> (%sp)[16byte]\r\n. . .\r\n```\r\nWhen `relink_special_ibl_xfer()` is called the `BR` instruction of the `LDR`/`BR` pair overwrites:\r\n```\r\n. . .\r\n  0x0000000041e424b8  f9403f81   ldr    +0x78(%x28)[8byte] -> %x1     <-- ldr    +0x78(%x28)[8byte] -> %x1\r\n  0x0000000041e424bc  d61f0020   br     %x1                           <-- ldr    +0x78(%x28)[8byte] -> %x1\r\nclean_call_save:\r\n  0x0000000041e424c0  a90007e0   stp    %x0 %x1 -> (%sp)[16byte]      <-- br     %x1     <-- STP overwritten!\r\n. . .\r\n```\r\n\r\nWe have not seen this bug cause failure before due to `NOP` padding used for e.g. cache alignment which depends on the machine's cache line size:\r\n```\r\nclient_ibl_xfer:\r\n. . .\r\n  0x00000000310124ac  f9403f81   ldr    +0x78(%x28)[8byte] -> %x1  <-- ldr    +0x78(%x28)[8byte] -> %x1\r\n  0x00000000310124b0  d61f0020   br     %x1                        <-- ldr    +0x78(%x28)[8byte] -> %x1\r\n  0x00000000310124b4  d503201f   nop                               <-- br     %x1\r\n  0x00000000310124b8  d503201f   nop\r\n  0x00000000310124bc  d503201f   nop\r\nclean_call_save:\r\n  0x00000000310124c0  a90007e0   stp    %x0 %x1 -> (%sp)[16byte]   <-- NOT overwritten because of NOP padding above.\r\n. . .\r\n```", 'state': 'closed', 'created_at': '2021-09-27T17:51:53.000Z', 'updated_at': '2023-03-22T21:29:21.453Z', 'closed_at': None, 'closed_by': None, 'labels': ['Bug-DRCrash', 'OpSys-AArch64'], 'milestone': None, 'assignees': [{'id': 2184, 'username': 'AssadHashmi', 'name': 'Assad Hashmi', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/bb303c5f98bbeb70c2ed38c1b2835608?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/AssadHashmi'}], 'author': {'id': 2184, 'username': 'AssadHashmi', 'name': 'Assad Hashmi', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/bb303c5f98bbeb70c2ed38c1b2835608?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/AssadHashmi'}, 'type': 'ISSUE', 'assignee': {'id': 2184, 'username': 'AssadHashmi', 'name': 'Assad Hashmi', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/bb303c5f98bbeb70c2ed38c1b2835608?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/AssadHashmi'}, 'user_notes_count': 0, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/5129', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5129', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5129/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/5129/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#5129', 'relative': '#5129', 'full': 'DynamoRIO/dynamorio#5129'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82549, 'iid': 4884, 'project_id': 160, 'title': 'Asynch signal arriving in ni-syscall-ending block results in premature and duplicated pre-syscall-handler execution', 'description': "If a signal arrives in a block that ends in a non-ignorable syscall, we'll unlink it, and when back in dispatch we check for the syscall *before* the signal.  We do the pre-syscall handling, then try to run the syscall: but enter_fcache sees signals_pending and bails.  We then go run the signal handler, but we never undo the pre-syscall handling.  Once the handler returns we'll go execute the syscall for real, duplicating the pre-syscall handling.\r\n\r\nDepending on the syscall, this may not matter, but some syscalls are hard to undo and premature execution and/or duplication might result in issues.\r\n\r\n```\r\nExit from F91(0x0000ffff807775e0).0x0000aaaa75281e70 (shared)   \r\n (interrupted by delayable signal)\r\nEntry into do_syscall to execute a non-ignorable system call\r\nsystem call 98\r\nSignal arrived in DR: aborting syscall enter; interrupted 0x0000ffff80777600\r\nreceive_pending_signal\r\n        receiving signal 27\r\n\r\n<run handler>\r\n\r\nreceive_pending_signal\r\n        clearing signals_pending flag\r\n\r\nd_r_dispatch: target = 0x0000aaaad5b4ac74\r\nEntry into F241(0x0000aaaad5b4ac74).0x0000aaaa755acee0 (shared)\r\n        \r\nExit from F298(0x0000aaaabe514750).0x0000aaaa755b2258 (shared)  \r\n (block ends with syscall)\r\nEntry into do_syscall to execute a non-ignorable system call\r\nsystem call 139\r\nrt_sigreturn()\r\n\r\nset next tag to 0x0000ffff80777600, sc->SC_XIP to 0x0000aaaa75276c80\r\nfor sigreturn, set sys_param1 to 0x0000aaaad6b4cd40\r\nExit from asynch event\r\npost-sigreturn: setting xax/r0 to 0x0000aaaad6b4cd40, asynch_target=0x0000ffff80777600\r\npost syscall: sysnum=0x000000000000008b, result=0x0000aaaad6b4cd40 (-692794048)\r\nfinished handling system call\r\n\r\nd_r_dispatch: target = 0x0000ffff80777600\r\nEntry into F1(0x0000ffff80777600).0x0000aaaa7527a00c (shared)\r\n        \r\nExit from F1(0x0000ffff80777600).0x0000aaaa7527a0f4 (shared)    \r\n (block ends with syscall)\r\nEntry into do_syscall to execute a non-ignorable system call\r\nsystem call 98\r\nExit from system call\r\npost syscall: sysnum=0x0000000000000062, result=0xffffffffffffff92 (-110)\r\nfinished handling system call\r\n```\r\n\r\nConfirming it's targeting the syscall via tail-dup, here's F91:\r\n```\r\ninterp: start_pc = 0x0000ffff807775e0\r\n  0x0000ffff807775e0  d3407c08   ubfm   %x0 $0x00 $0x1f -> %x8\r\n  0x0000ffff807775e4  aa0103e0   orr    %xzr %x1 lsl $0x00 -> %x0\r\n  0x0000ffff807775e8  aa0203e1   orr    %xzr %x2 lsl $0x00 -> %x1\r\n  0x0000ffff807775ec  aa0303e2   orr    %xzr %x3 lsl $0x00 -> %x2\r\n  0x0000ffff807775f0  aa0403e3   orr    %xzr %x4 lsl $0x00 -> %x3\r\n  0x0000ffff807775f4  aa0503e4   orr    %xzr %x5 lsl $0x00 -> %x4\r\n  0x0000ffff807775f8  aa0603e5   orr    %xzr %x6 lsl $0x00 -> %x5\r\n  0x0000ffff807775fc  aa0703e6   orr    %xzr %x7 lsl $0x00 -> %x6\r\n  0x0000ffff80777600  d4000001   svc    $0x0000\r\nend_pc = 0x0000ffff80777604\r\n```\r\n\r\nAlso xref https://github.com/DynamoRIO/dynamorio/issues/4878#issuecomment-827726462 involving similar code in dispatch where signal reasons are not checked early enough and we not only print the wrong reasons but try to add to the IBT when the target is not known to be missing: I'm likely going to lump that in here.", 'state': 'closed', 'created_at': '2021-04-28T16:41:32.000Z', 'updated_at': '2023-03-22T21:28:12.190Z', 'closed_at': None, 'closed_by': None, 'labels': [], 'milestone': None, 'assignees': [{'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}], 'author': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'type': 'ISSUE', 'assignee': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'user_notes_count': 1, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/4884', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4884', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4884/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4884/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#4884', 'relative': '#4884', 'full': 'DynamoRIO/dynamorio#4884'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82494, 'iid': 4717, 'project_id': 160, 'title': 'HANG api.static_prepop on aarch64', 'description': 'Split from #1578 \r\n\r\nThis test hangs every time on the tx1:\r\n```\r\nderek@tx1:~/dr/build$ ctest -V -R static_prepop\r\nUpdateCTestConfiguration  from :/home/derek/dr/build/DartConfiguration.tcl\r\nParse Config file:/home/derek/dr/build/DartConfiguration.tcl\r\nUpdateCTestConfiguration  from :/home/derek/dr/build/DartConfiguration.tcl\r\nParse Config file:/home/derek/dr/build/DartConfiguration.tcl\r\nTest project /home/derek/dr/build\r\nConstructing a list of tests\r\nDone constructing a list of tests\r\nUpdating test list for fixtures\r\nAdded 0 tests to meet fixture requirements\r\nChecking test dependency graph...\r\nChecking test dependency graph end\r\ntest 224\r\n    Start 224: code_api|api.static_prepop\r\n\r\n224: Test command: /home/derek/dr/build/bin64/runstats "-s" "90" "-killpg" "-silent" "-env" "LD_LIBRARY_PATH" "/home/derek/dr/build/lib64/debug:/home/derek/dr/build/ext/lib64/debug:" "-env" "DYNAMORIO_OPTIONS" "-stderr_mask 0xC -dumpcore_mask 0 -code_api" "/home/derek/dr/build/suite/tests/bin/api.static_prepop"\r\n224: Test timeout computed to be: 1500\r\n224: pre-DR init\r\n224: in dr_client_main\r\n224: bb asm_func\r\n224: bb asm_label1\r\n224: bb asm_label2\r\n224: bb asm_label3\r\n224: bb asm_return\r\n224: pre-DR start\r\n^C\r\n```', 'state': 'closed', 'created_at': '2021-02-05T16:57:38.000Z', 'updated_at': '2023-03-22T21:27:07.201Z', 'closed_at': None, 'closed_by': None, 'labels': ['Bug-Hang', 'OpSys-AArch64'], 'milestone': None, 'assignees': [{'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}], 'author': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'type': 'ISSUE', 'assignee': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'user_notes_count': 1, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/4717', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4717', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4717/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4717/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#4717', 'relative': '#4717', 'full': 'DynamoRIO/dynamorio#4717'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82406, 'iid': 4530, 'project_id': 160, 'title': 'Improve opnd_create_base_disp_aarch64', 'description': '*Created by: yury-khrustalev*\n\nThis API function for creating base-disp memory reference operands for AArch64\r\n\r\n```\r\nopnd_t\r\nopnd_create_base_disp_aarch64(reg_id_t base_reg, reg_id_t index_reg,\r\n                              dr_extend_type_t extend_type, bool scaled, int disp,\r\n                              dr_opnd_flags_t flags, opnd_size_t size);\r\n```\r\n\r\nhas confusing API especially when comparing it to [Arm A64 specification](https://developer.arm.com/documentation/ddi0487/latest/).\r\n\r\nThe intent of this ticket is to discuss how this function can be improved. Currently, the problems are:\r\n\r\n- This function is essentially a single interface for two different operations (it violates separation of concerns principle).\r\n- It provides too many degrees of freedom and too many possible combinations than it actually should (and most of de jure "supported" pathways are not even checked within the function) (there should one and only one way to do something).\r\n- Parameter `dr_extend_type_t extend_type` implies all values from this enum may be valid, while only two of them actually make sense in this context (well, three if we agree to use `UXTX` for `LSL`).\r\n- Parameter `dr_opnd_flags_t flags` is set to the resulting `opnd`, but is in fact not used (at least not for AArch64), however some of the values of the enum look as if they may affect the operand somehow, so a user would be vainly contemplating which value to choose.\r\n- Parameter `opnd_size_t size` has confusing name and type. It is hard to guess that this is, in fact, a _transfer size_ i.e. the size of the destination operand(s) in the instruction in which this (memref) operand is intended for.\r\n\r\nThe [code review](https://codereview.appspot.com/308050043) for addition of this function raised some of these concerns, but they had not been addressed.\r\n\r\nThe decision to store `size` in the operand instead of storing the _shift amount_ was really bad. How can an operand carry a dependency on another operand?\r\n\r\nI would like to suggest to replace this function with the following two functions:\r\n\r\n```\r\n/**\r\n * Returns a memory reference operand that refers to a base register X0 - X30 or\r\n * stack pointer XSP plus an extended and optionally shifted index register.\r\n *\r\n * Index register must be either Xm or Wm register. Together with the parameter\r\n * \\p sign_extended it affects the type of extension used for the operand: SXTW\r\n * and UXTW when using signed and unsigned extension correspondingly with a Wm\r\n * register and LSL (UXTX) for Xm index register (behaviour for UXTX and SXTX is\r\n * identical in this context).\r\n *\r\n * The \\p amount parameter determines optional shift of the extended value of\r\n * the index register and must be either 0 or log2(sz) where sz is the size of\r\n * the destination register in bytes (i.e. transfer size: 0 for 8-bit registers,\r\n * 1 for 16-bit registers, 2 for 32-bit registers, 3 for 64-bit registers, etc).\r\n *\r\n * \\note AArch64-only.\r\n */\r\nopnd_t\r\nopnd_create_base_disp_reg(reg_id_t base_reg, reg_id_t index_reg, int amount, bool sign_extended);\r\n\r\n/**\r\n * Returns a memory reference operand that refers to a base register X0 - X30 or\r\n * stack pointer XSP plus a constant signed displacement.\r\n *\r\n * The usable offsets depend on the type of instruction and the size of the\r\n * destination register (the transfer size).\r\n *\r\n * \\note AArch64-only.\r\n */\r\nopnd_t\r\nopnd_create_base_disp_imm(reg_id_t base_reg, int offset);\r\n```\r\nAlternatively, a "merged" version of the two functions above may be used (which I don\'t really like), it would use offset for the displacement when `index_reg = DR_REG_NULL and amount == 0`:\r\n\r\n```\r\nopnd_t\r\nopnd_create_base_disp_aarch64(reg_id_t base_reg, reg_id_t index_reg,\r\n                              int amount, bool sign_extended, int offset);\r\n```\r\n\r\nBut this is only to adhere to the "tradition" introduced by the existing function. I find it really a bad idea to create such facades. Imagine a god-like `opnd_create_opnd` function with a gazillion of parameters.\r\n', 'state': 'opened', 'created_at': '2020-11-12T19:03:32.000Z', 'updated_at': '2023-03-22T21:26:22.703Z', 'closed_at': None, 'closed_by': None, 'labels': ['Component-API', 'Component-IR', 'OpSys-AArch64', 'Type-Feature'], 'milestone': None, 'assignees': [], 'author': {'id': 1, 'username': 'root', 'name': 'Administrator', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/e64c7d89f26bd1972efa854d13d7dd61?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/root'}, 'type': 'ISSUE', 'assignee': None, 'user_notes_count': 4, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/4530', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4530', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4530/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4530/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#4530', 'relative': '#4530', 'full': 'DynamoRIO/dynamorio#4530'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82342, 'iid': 4403, 'project_id': 160, 'title': 'drmemtrace address elision ignoring non-memref writes, leading to incorrect addresses', 'description': "PR #3977 for #2001 put in elision of recorded addresses we can deduce in post-processing.  But it turns out that non-memory-accessing instructions are not properly considered when looking at register mods.  The tool.drcacheoff.burst_traceopts test which compares an optimized to un-optimized trace is just missing this pattern of modification.\r\n\r\nI made a tool to measure how often this happens and the ratio on most apps is about 1 in 500 data addresses being wrong (typically they'll be off by some small constant depending on the reg mod in between).", 'state': 'closed', 'created_at': '2020-08-12T23:25:49.000Z', 'updated_at': '2023-03-22T21:24:51.592Z', 'closed_at': None, 'closed_by': None, 'labels': ['Component-DrCacheSim'], 'milestone': None, 'assignees': [{'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}], 'author': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'type': 'ISSUE', 'assignee': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'user_notes_count': 0, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/4403', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4403', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4403/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4403/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#4403', 'relative': '#4403', 'full': 'DynamoRIO/dynamorio#4403'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82325, 'iid': 4370, 'project_id': 160, 'title': 'CMake 3.18.0 build of master is broken (Ubuntu 16.04/18.04)', 'description': "*Created by: SweetVishnya*\n\ncommit 12496fe8bb2636fb8df66bca211469b967795414\r\n\r\n```\r\nsudo docker run --rm -it ubuntu:16.04 /bin/bash\r\napt update && apt upgrade -y && apt install -y git build-essential wget\r\nwget https://github.com/Kitware/CMake/releases/download/v3.18.0/cmake-3.18.0-Linux-x86_64.sh\r\nsh cmake-3.18.0-Linux-x86_64.sh --prefix=/ --exclude-subdir --skip-license\r\ngit clone https://github.com/DynamoRIO/dynamorio.git\r\ncd dynamorio\r\nmkdir build\r\ncd build\r\ncmake ..\r\nmake\r\n```\r\n\r\nI get the following compilation error.\r\n\r\n```\r\nScanning dependencies of target dynamorio_static\r\n[  4%] Building C object core/CMakeFiles/dynamorio_static.dir/options.c.o\r\n[  4%] Building C object core/CMakeFiles/dynamorio_static.dir/dynamo.c.o\r\n[  4%] Building C object core/CMakeFiles/dynamorio_static.dir/fragment.c.o\r\n[  4%] Building C object core/CMakeFiles/dynamorio_static.dir/fcache.c.o\r\n[  5%] Building C object core/CMakeFiles/dynamorio_static.dir/link.c.o\r\n[  5%] Building C object core/CMakeFiles/dynamorio_static.dir/dispatch.c.o\r\n[  5%] Building C object core/CMakeFiles/dynamorio_static.dir/emit.c.o\r\n[  5%] Building C object core/CMakeFiles/dynamorio_static.dir/utils.c.o\r\n[  5%] Building C object core/CMakeFiles/dynamorio_static.dir/config.c.o\r\n[  6%] Building C object core/CMakeFiles/dynamorio_static.dir/stats.c.o\r\n[  6%] Building C object core/CMakeFiles/dynamorio_static.dir/heap.c.o\r\n[  6%] Building C object core/CMakeFiles/dynamorio_static.dir/monitor.c.o\r\n[  6%] Building C object core/CMakeFiles/dynamorio_static.dir/perfctr.c.o\r\n[  7%] Building C object core/CMakeFiles/dynamorio_static.dir/vmareas.c.o\r\n[  7%] Building C object core/CMakeFiles/dynamorio_static.dir/rct.c.o\r\n[  7%] Building C object core/CMakeFiles/dynamorio_static.dir/hotpatch.c.o\r\n[  7%] Building C object core/CMakeFiles/dynamorio_static.dir/hashtable.c.o\r\n[  7%] Building C object core/CMakeFiles/dynamorio_static.dir/module_list.c.o\r\n[  8%] Building C object core/CMakeFiles/dynamorio_static.dir/moduledb.c.o\r\n[  8%] Building C object core/CMakeFiles/dynamorio_static.dir/perscache.c.o\r\n[  8%] Building C object core/CMakeFiles/dynamorio_static.dir/nudge.c.o\r\n[  8%] Building C object core/CMakeFiles/dynamorio_static.dir/synch.c.o\r\n[  8%] Building C object core/CMakeFiles/dynamorio_static.dir/buildmark.c.o\r\n[  9%] Building C object core/CMakeFiles/dynamorio_static.dir/loader_shared.c.o\r\n[  9%] Building C object core/CMakeFiles/dynamorio_static.dir/io.c.o\r\n[  9%] Building C object core/CMakeFiles/dynamorio_static.dir/native_exec.c.o\r\n[  9%] Building C object core/CMakeFiles/dynamorio_static.dir/lib/instrument.c.o\r\n[ 10%] Building C object core/CMakeFiles/dynamorio_static.dir/translate.c.o\r\n[ 10%] Building C object core/CMakeFiles/dynamorio_static.dir/annotations.c.o\r\n[ 10%] Building C object core/CMakeFiles/dynamorio_static.dir/jit_opt.c.o\r\n[ 10%] Building C object core/CMakeFiles/dynamorio_static.dir/string.c.o\r\n[ 10%] Building C object core/CMakeFiles/dynamorio_static.dir/arch/arch.c.o\r\n[ 11%] Building C object core/CMakeFiles/dynamorio_static.dir/arch/emit_utils_shared.c.o\r\n[ 11%] Building C object core/CMakeFiles/dynamorio_static.dir/arch/x86/emit_utils.c.o\r\n[ 11%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/opnd_shared.c.o\r\n[ 11%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/x86/opnd.c.o\r\n[ 12%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/instr_shared.c.o\r\n[ 12%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/x86/instr.c.o\r\n[ 12%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/instrlist.c.o\r\n[ 12%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/decode_shared.c.o\r\n[ 12%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/x86/decode.c.o\r\n[ 13%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/encode_shared.c.o\r\n[ 13%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/x86/encode.c.o\r\n[ 13%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/disassemble_shared.c.o\r\n[ 13%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/x86/disassemble.c.o\r\n[ 13%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/ir_utils_shared.c.o\r\n[ 14%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/x86/ir_utils.c.o\r\n[ 14%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/x86/decode_table.c.o\r\n[ 14%] Building C object core/CMakeFiles/dynamorio_static.dir/ir/x86/decode_fast.c.o\r\n[ 14%] Building C object core/CMakeFiles/dynamorio_static.dir/arch/interp.c.o\r\n[ 15%] Building C object core/CMakeFiles/dynamorio_static.dir/arch/proc_shared.c.o\r\n[ 15%] Building C object core/CMakeFiles/dynamorio_static.dir/arch/x86/proc.c.o\r\n[ 15%] Building C object core/CMakeFiles/dynamorio_static.dir/arch/mangle_shared.c.o\r\n[ 15%] Building C object core/CMakeFiles/dynamorio_static.dir/arch/x86/mangle.c.o\r\n[ 15%] Building C object core/CMakeFiles/dynamorio_static.dir/arch/clean_call_opt_shared.c.o\r\n[ 16%] Building C object core/CMakeFiles/dynamorio_static.dir/arch/x86/clean_call_opt.c.o\r\n[ 16%] Building C object core/CMakeFiles/dynamorio_static.dir/arch/steal_reg.c.o\r\n[ 16%] Building C object core/CMakeFiles/dynamorio_static.dir/arch/x86_code.c.o\r\n[ 16%] Building ASM object core/CMakeFiles/dynamorio_static.dir/arch/x86/x86.asm.o\r\ncpp: error: STATIC_LIBRARY: No such file or directory\r\ncpp: warning: '-x c' after last input file has no effect\r\ncpp: error: unrecognized command line option '--defsym'\r\ncpp: fatal error: no input files\r\ncompilation terminated.\r\ncore/CMakeFiles/dynamorio_static.dir/build.make:838: recipe for target 'core/CMakeFiles/dynamorio_static.dir/arch/x86/x86.asm.o' failed\r\nmake[2]: *** [core/CMakeFiles/dynamorio_static.dir/arch/x86/x86.asm.o] Error 1\r\nCMakeFiles/Makefile2:751: recipe for target 'core/CMakeFiles/dynamorio_static.dir/all' failed\r\nmake[1]: *** [core/CMakeFiles/dynamorio_static.dir/all] Error 2\r\nMakefile:170: recipe for target 'all' failed\r\nmake: *** [all] Error 2\r\n```\r\n\r\n```\r\nVERBOSE=1 make\r\n```\r\n\r\n```\r\n[  4%] Building ASM object core/CMakeFiles/dynamorio_static.dir/arch/x86/x86.asm.o\r\ncd /dynamorio/build/core && /usr/bin/cpp  -O2 -g -DNDEBUG -fPIC -I/dynamorio/core/drlibc -I/dynamorio/core/ir/x86 -I/dynamorio/core/arch/x86 -I/dynamorio/core/unix -I/dynamorio/core/ir -I/dynamorio/core/arch -I/dynamorio/core/lib -I/dynamorio/build -I/dynamorio/build/include/annotations --defsym STATIC_LIBRARY -DCPP2ASM -E /dynamorio/core/arch/x86/x86.asm -o CMakeFiles/dynamorio_static.dir/arch/x86/x86.asm.o.s\r\ncpp: error: STATIC_LIBRARY: No such file or directory\r\ncpp: warning: '-x c' after last input file has no effect\r\ncpp: error: unrecognized command line option '--defsym'\r\ncpp: fatal error: no input files\r\ncompilation terminated.\r\ncore/CMakeFiles/dynamorio_static.dir/build.make:838: recipe for target 'core/CMakeFiles/dynamorio_static.dir/arch/x86/x86.asm.o' failed\r\nmake[2]: *** [core/CMakeFiles/dynamorio_static.dir/arch/x86/x86.asm.o] Error 1\r\nmake[2]: Leaving directory '/dynamorio/build'\r\nCMakeFiles/Makefile2:751: recipe for target 'core/CMakeFiles/dynamorio_static.dir/all' failed\r\nmake[1]: *** [core/CMakeFiles/dynamorio_static.dir/all] Error 2\r\nmake[1]: Leaving directory '/dynamorio/build'\r\nMakefile:170: recipe for target 'all' failed\r\nmake: *** [all] Error 2\r\n```", 'state': 'closed', 'created_at': '2020-07-16T13:05:56.000Z', 'updated_at': '2023-03-22T21:24:44.071Z', 'closed_at': None, 'closed_by': None, 'labels': ['Component-Build', 'Hotlist-ContinuousIntegration', 'OpSys-Linux', 'Priority-High'], 'milestone': None, 'assignees': [{'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}], 'author': {'id': 1, 'username': 'root', 'name': 'Administrator', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/e64c7d89f26bd1972efa854d13d7dd61?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/root'}, 'type': 'ISSUE', 'assignee': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'user_notes_count': 15, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/4370', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4370', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4370/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4370/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#4370', 'relative': '#4370', 'full': 'DynamoRIO/dynamorio#4370'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82223, 'iid': 4134, 'project_id': 160, 'title': 'DrBBDup: The DynamoRIO Basic Block Duplication Extension', 'description': "This is the main issue page concerning the DynamoRIO Basic Block Duplication Extension: a code builder that duplicates code of basic blocks and dispatches control according to runtime conditions so that different instrumentation of the same basic blocks may be efficiently executed.\r\n\r\nDuring the app2app stage, the code of a basic block is duplicated and prepended to the original fragment in order to generate multiple copies. DrBBDup manages these copies by maintaining book-keep data per fragment and inserting dispatching code to execute the appropriate basic block copy.\r\n\r\nFor example, lets say we have the following bb:\r\n\r\n```\r\nmov ebx ecx\r\nmov esi eax\r\nret\r\n```\r\n\r\nAt a very high-level, DrBBDup produces code as follows\r\n\r\n```\r\ncmp [eax] 0x00000000\r\njz LABEL 2\r\n  \r\nLABEL 1 // BB Version 1\r\n_INSTRUM CODE A_\r\nmov ebx ecx\r\n_INSTRUM CODE A_\r\nmov esi eax\r\njmp EXIT LABEL\r\n\r\nLABEL 2 // BB Version 2\r\n_INSTRUM CODE B_\r\nmov ebx ecx\r\n_INSTRUM CODE B_\r\nmov esi eax\r\n\r\nEXIT LABEL\r\nret /* Not duplicated to abide by DR bb rules */\r\n```\r\n\r\nThe number of basic block versions is customisable to suit the user's needs. In the example the dup count is 1 because we produce only one additional copy.\r\n\r\nApart from the main functionality of DrBBDup, this issue also encompasses the following:\r\n1.  Dynamic generation of basic block copies (contingent on #3778 being merged).\r\n2. Gathering of general statistics, such as tracking which cases are executed most frequently.\r\n3. Support for Arm.\r\n4. Include sample program.\r\n\r\nThere are a number of applications which I built using the extension. For instance, with two bb copies, one can turn on/off instruction tracing via nudges during runtime. One basic block copy is instrumented with tracing code, and another version with no instrumentation at all. Depending on a flag, the user can control which basic block copy is executed at runtime, without the need to undergo expensive flushing.\r\n\r\n", 'state': 'closed', 'created_at': '2020-02-25T02:02:19.000Z', 'updated_at': '2023-03-22T21:23:29.787Z', 'closed_at': None, 'closed_by': None, 'labels': ['Type-Feature'], 'milestone': None, 'assignees': [{'id': 2202, 'username': 'johnfxgalea', 'name': 'John F.X. Galea', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/e8bd49d970c0f6ed31d62f5421cf6e23?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/johnfxgalea'}], 'author': {'id': 2202, 'username': 'johnfxgalea', 'name': 'John F.X. Galea', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/e8bd49d970c0f6ed31d62f5421cf6e23?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/johnfxgalea'}, 'type': 'ISSUE', 'assignee': {'id': 2202, 'username': 'johnfxgalea', 'name': 'John F.X. Galea', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/e8bd49d970c0f6ed31d62f5421cf6e23?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/johnfxgalea'}, 'user_notes_count': 50, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/4134', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4134', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4134/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4134/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#4134', 'relative': '#4134', 'full': 'DynamoRIO/dynamorio#4134'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82196, 'iid': 4074, 'project_id': 160, 'title': 'ASSERTs on receiving nudges on Windows', 'description': 'The client.nudge_test hits multiple problems, including these two asserts:\r\n\r\n### ASSERT in ntdll_redir in infloop on nudge => relax for nudge thread; actually I undid this after the next assert was fixed to *not* swap state\r\n\r\nThe app exits b/c of this:\r\n```\r\nthank you for testing the client interface\r\nnudge delivered 10\r\n<Application D:\\derek\\dr\\git\\build_x86_dbg_tests\\suite\\tests\\bin\\win32.infloop.exe (10796).  Internal Error: DynamoRIO debug check failure: D:\\derek\\dr\\git\\src\\core\\win32\\drwinapi\\ntdll_redir.c:263 !dynamo_initialized || dynamo_exited || standalone_library || get_thread_private_dcontext() == NULL || !os_using_app_state(get_thread_private_dcontext())\r\n(Error occurred @1149 frags)\r\n```\r\n\r\nIt\'s non-det: not every run.\r\nCaught it:\r\n```\r\n04 014dfa28 5ad5c713 dynamorio!report_dynamorio_problem+0x5a1 [d:\\derek\\dr\\git\\src\\core\\utils.c @ 2255] \r\n05 014dfb5c 5afa0292 dynamorio!d_r_internal_error+0x133 [d:\\derek\\dr\\git\\src\\core\\utils.c @ 176] \r\n06 014dfb7c 5af9f33c dynamorio!redirect_heap_call+0x62 [d:\\derek\\dr\\git\\src\\core\\win32\\drwinapi\\ntdll_redir.c @ 261] \r\n07 014dfb88 5afa1644 dynamorio!redirect_RtlValidateHeap+0xc [d:\\derek\\dr\\git\\src\\core\\win32\\drwinapi\\ntdll_redir.c @ 437] \r\n08 014dfb9c 6dc4706b dynamorio!redirect_HeapValidate+0x14 [d:\\derek\\dr\\git\\src\\core\\win32\\drwinapi\\kernel32_mem.c @ 172] \r\n09 014dfbb0 6dc45c7e client_nudge_test_dll!_CrtIsValidHeapPointer+0x2b [minkernel\\crts\\ucrt\\src\\appcrt\\heap\\debug_heap.cpp @ 1407] \r\n0a 014dfbc8 6dc4765c client_nudge_test_dll!free_dbg_nolock+0xce [minkernel\\crts\\ucrt\\src\\appcrt\\heap\\debug_heap.cpp @ 904] \r\n0b 014dfc08 6dc42dcf client_nudge_test_dll!_free_dbg+0x7c [minkernel\\crts\\ucrt\\src\\appcrt\\heap\\debug_heap.cpp @ 1030] \r\n0c 014dfc18 6dc42e2f client_nudge_test_dll!__vcrt_freefls+0x1f [f:\\dd\\vctools\\crt\\vcruntime\\src\\internal\\per_thread_data.cpp @ 195] \r\n0d 014dfc2c 6dc4283a client_nudge_test_dll!__vcrt_freeptd+0x4f [f:\\dd\\vctools\\crt\\vcruntime\\src\\internal\\per_thread_data.cpp @ 186] \r\n0e 014dfc38 6dc4196d client_nudge_test_dll!__vcrt_thread_detach+0xa [f:\\dd\\vctools\\crt\\vcruntime\\src\\internal\\initialization.cpp @ 117] \r\n0f 014dfc40 6dc4110c client_nudge_test_dll!__scrt_dllmain_crt_thread_detach+0xd [f:\\dd\\vctools\\crt\\vcstartup\\src\\utility\\utility.cpp @ 455] \r\n10 014dfc50 6dc4148b client_nudge_test_dll!dllmain_crt_dispatch+0x5c [f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\dll_dllmain.cpp @ 140] \r\n11 014dfc94 6dc4156f client_nudge_test_dll!dllmain_dispatch+0x10b [f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\dll_dllmain.cpp @ 211] \r\n12 014dfca8 5af974de client_nudge_test_dll!_DllMainCRTStartup+0x1f [f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\dll_dllmain.cpp @ 252] \r\n13 014dfd98 5ae434bd dynamorio!privload_call_entry+0x7ee [d:\\derek\\dr\\git\\src\\core\\win32\\loader.c @ 1498] \r\n14 014dfdb0 5ae4204c dynamorio!privload_call_entry_if_not_yet+0x7d [d:\\derek\\dr\\git\\src\\core\\loader_shared.c @ 123] \r\n15 014dfdc8 5acad24a dynamorio!loader_thread_exit+0x5c [d:\\derek\\dr\\git\\src\\core\\loader_shared.c @ 314] \r\n16 014dfe3c 5ac9e7ef dynamorio!dynamo_thread_exit_common+0x3da [d:\\derek\\dr\\git\\src\\core\\dynamo.c @ 2578] \r\n17 014dfe58 5af07c51 dynamorio!dynamo_thread_exit+0x1f [d:\\derek\\dr\\git\\src\\core\\dynamo.c @ 2684] \r\n18 014dfe98 5af22c02 dynamorio!cleanup_and_terminate+0x4d [D:\\derek\\dr\\git\\build_x86_dbg_tests\\core\\CMakeFiles\\dynamorio.dir\\arch\\x86\\x86.asm.obj.s @ 2032] \r\n19 014dfeb0 5ae38f89 dynamorio!os_terminate+0x12 [d:\\derek\\dr\\git\\src\\core\\win32\\os.c @ 1627] \r\n1a 014dfed0 5ae38e03 dynamorio!nudge_thread_cleanup+0x179 [d:\\derek\\dr\\git\\src\\core\\nudge.c @ 185] \r\n1b 014dff38 25c79a5b dynamorio!generic_nudge_handler+0x413 [d:\\derek\\dr\\git\\src\\core\\nudge.c @ 275] \r\n```\r\n\r\nI thought we\'d just be calling os_thread_under_dynamo() too early: but the\r\nWindows version, unlike UNIX, does *not* call os_swap_context()!\r\nWeird.\r\nInstead various routines call swap_peb_pointer() directly: including\r\nnudge_thread_cleanup().\r\n\r\n### ASSERT in infloop in tls cleanup post-nudge => swapping peb pointer too early\r\n```\r\nnudge delivered 10\r\n<Application D:\\derek\\dr\\git\\build_x86_dbg_tests\\suite\\tests\\bin\\win32.infloop.exe (12636).  Internal Error: DynamoRIO debug check failure: D:\\derek\\dr\\git\\src\\core\\win32\\loader.c:1450 tls_array_count > opd->tls_idx && tls_array != NULL\r\n(Error occurred @42071 frags)\r\nversion 7.91.18294, custom build\r\n```\r\n\r\nLooks like a dynamically loaded lib w/ static TLS, which we don\'t support,\r\nbut that\'s after a dbgcrt assert is raised on a free:\r\n```\r\n05 050f500c 5af96e5a dynamorio!d_r_internal_error(char * file = 0x5b09ba88 "D:\\derek\\dr\\git\\src\\core\\win32\\loader.c", int line = 0n1450, char * expr = 0x5b09c854 "tls_array_count > opd->tls_idx && tls_array != NULL")+0x133 [d:\\derek\\dr\\git\\src\\core\\utils.c @ 176] \r\n06 050f50fc 5ae434bd dynamorio!privload_call_entry(struct _dcontext_t * dcontext = 0x1c146d40, struct _privmod_t * privmod = 0x1c095e98, unsigned int reason = 1)+0x16a [d:\\derek\\dr\\git\\src\\core\\win32\\loader.c @ 1450] \r\n07 050f5114 5ae432e0 dynamorio!privload_call_entry_if_not_yet(struct _dcontext_t * dcontext = 0x1c146d40, struct _privmod_t * privmod = 0x1c095e98, int reason = 0n1)+0x7d [d:\\derek\\dr\\git\\src\\core\\loader_shared.c @ 123] \r\n08 050f5130 5ae42510 dynamorio!privload_load_finalize(struct _dcontext_t * dcontext = 0x1c146d40, struct _privmod_t * privmod = 0x1c095e98)+0xa0 [d:\\derek\\dr\\git\\src\\core\\loader_shared.c @ 845] \r\n09 050f5164 5af9a8fc dynamorio!privload_load(char * filename = 0x5b0fa910 "C:\\WINDOWS/system32/msvcrt.dll", struct _privmod_t * dependent = 0x1c095c90, char client = 0n0 \'\')+0x320 [d:\\derek\\dr\\git\\src\\core\\loader_shared.c @ 701] \r\n0a 050f5184 5af9bb1e dynamorio!privload_locate_and_load(char * impname = 0x02cdb3e2 "msvcrt.dll", struct _privmod_t * dependent = 0x1c095c90, char reachable = 0n0 \'\')+0x24c [d:\\derek\\dr\\git\\src\\core\\win32\\loader.c @ 1875] \r\n0b 050f51ac 5af97b61 dynamorio!privload_lookup_locate_and_load(char * name = 0x02cdb3e2 "msvcrt.dll", struct _privmod_t * name_dependent = 0x1c095c90, struct _privmod_t * load_dependent = 0x1c095c90, char inc_refcnt = 0n1 \'\', char reachable = 0n0 \'\')+0x19e [d:\\derek\\dr\\git\\src\\core\\win32\\loader.c @ 1148] \r\n0c 050f51f4 5ae431bd dynamorio!privload_process_imports(struct _privmod_t * mod = 0x1c095c90)+0x271 [d:\\derek\\dr\\git\\src\\core\\win32\\loader.c @ 1221] \r\n0d 050f5208 5ae424ea dynamorio!privload_load_process(struct _privmod_t * privmod = 0x1c095c90)+0xad [d:\\derek\\dr\\git\\src\\core\\loader_shared.c @ 827] \r\n0e 050f5238 5af9a8fc dynamorio!privload_load(char * filename = 0x5b0fa910 "C:\\WINDOWS/system32/msvcrt.dll", struct _privmod_t * dependent = 0x00000000, char client = 0n0 \'\')+0x2fa [d:\\derek\\dr\\git\\src\\core\\loader_shared.c @ 695] \r\n0f 050f5258 5af9bb1e dynamorio!privload_locate_and_load(char * impname = 0x5b09d854 "kernel.appcore.dll", struct _privmod_t * dependent = 0x00000000, char reachable = 0n0 \'\')+0x24c [d:\\derek\\dr\\git\\src\\core\\win32\\loader.c @ 1875] \r\n10 050f5280 5af9672e dynamorio!privload_lookup_locate_and_load(char * name = 0x050f52c4 "api-ms-win-appmodel-runtime-l1-1-2.dll", struct _privmod_t * name_dependent = 0x00000000, struct _privmod_t * load_dependent = 0x00000000, char inc_refcnt = 0n1 \'\', char reachable = 0n0 \'\')+0x19e [d:\\derek\\dr\\git\\src\\core\\win32\\loader.c @ 1148] \r\n11 050f52a4 5ae41b7f dynamorio!privload_load_private_library(char * name = 0x050f52c4 "api-ms-win-appmodel-runtime-l1-1-2.dll", char reachable = 0n0 \'\')+0x2e [d:\\derek\\dr\\git\\src\\core\\win32\\loader.c @ 1163] \r\n12 050f52b4 5afa145d dynamorio!locate_and_load_private_library(char * name = 0x050f52c4 "api-ms-win-appmodel-runtime-l1-1-2.dll", char reachable = 0n0 \'\')+0x1f [d:\\derek\\dr\\git\\src\\core\\loader_shared.c @ 344] \r\n13 050f53d0 5afa1323 dynamorio!helper_LoadLibrary(char * name = 0x050f52c4 "api-ms-win-appmodel-runtime-l1-1-2.dll")+0x10d [d:\\derek\\dr\\git\\src\\core\\win32\\drwinapi\\kernel32_lib.c @ 146] \r\n14 050f54e4 5afa134c dynamorio!redirect_LoadLibraryW(wchar_t * name = 0x721b02a8 "api-ms-win-appmodel-runtime-l1-1-2")+0xe3 [d:\\derek\\dr\\git\\src\\core\\win32\\drwinapi\\kernel32_lib.c @ 183] \r\n15 050f54f0 721938d7 dynamorio!redirect_LoadLibraryExW(wchar_t * name = 0x721b02a8 "api-ms-win-appmodel-runtime-l1-1-2", void * reserved = 0x00000000, unsigned long flags = 0x800)+0xc [d:\\derek\\dr\\git\\src\\core\\win32\\drwinapi\\kernel32_lib.c @ 198] \r\n16 050f5508 721937b9 client_nudge_test_dll!try_load_library_from_system_directory(wchar_t * name = 0x721b02a8 "api-ms-win-appmodel-runtime-l1-1-2")+0x17 [minkernel\\crts\\ucrt\\src\\appcrt\\internal\\winapi_thunks.cpp @ 219] \r\n17 050f5524 7219360c client_nudge_test_dll!try_get_module(`anonymous-namespace\'::module_id id = api_ms_win_appmodel_runtime_l1_1_2 (0n18))+0x49 [minkernel\\crts\\ucrt\\src\\appcrt\\internal\\winapi_thunks.cpp @ 258] \r\n18 050f5538 72193893 client_nudge_test_dll!try_get_first_available_module(`anonymous-namespace\'::module_id * first = 0x721b049c, `anonymous-namespace\'::module_id * last = 0x721b04a0)+0x2c [minkernel\\crts\\ucrt\\src\\appcrt\\internal\\winapi_thunks.cpp @ 291] \r\n19 050f554c 72193687 client_nudge_test_dll!try_get_proc_address_from_first_available_module(char * name = 0x721b04a0 "AppPolicyGetShowDeveloperDiagnostic", `anonymous-namespace\'::module_id * first_module_id = 0x721b049c, `anonymous-namespace\'::module_id * last_module_id = 0x721b04a0)+0x13 [minkernel\\crts\\ucrt\\src\\appcrt\\internal\\winapi_thunks.cpp @ 309] \r\n1a 050f5570 7219341b client_nudge_test_dll!try_get_function(`anonymous-namespace\'::function_id id = AppPolicyGetShowDeveloperDiagnostic_id (0n30), char * name = 0x721b04a0 "AppPolicyGetShowDeveloperDiagnostic", `anonymous-namespace\'::module_id * first_module_id = 0x721b049c, `anonymous-namespace\'::module_id * last_module_id = 0x721b04a0)+0x57 [minkernel\\crts\\ucrt\\src\\appcrt\\internal\\winapi_thunks.cpp @ 346] \r\n1b 050f5588 721939c7 client_nudge_test_dll!try_get_AppPolicyGetShowDeveloperDiagnostic(void)+0x1b [minkernel\\crts\\ucrt\\src\\appcrt\\internal\\winapi_thunks.cpp @ 397] \r\n1c 050f559c 72190e8e client_nudge_test_dll!__acrt_AppPolicyGetShowDeveloperDiagnosticInternal(AppPolicyShowDeveloperDiagnostic * policy = 0x050f55b8)+0x17 [minkernel\\crts\\ucrt\\src\\appcrt\\internal\\winapi_thunks.cpp @ 791] \r\n1d 050f55a8 72190d46 client_nudge_test_dll!`__acrt_get_developer_information_policy\'::`2\'::developer_information_policy_properties::appmodel_get_policy(AppPolicyShowDeveloperDiagnostic * appmodelPolicy = 0x050f55b8)+0xe [minkernel\\crts\\ucrt\\src\\appcrt\\internal\\win_policies.cpp @ 143] \r\n1e 050f55c4 72190f3c client_nudge_test_dll!get_cached_win_policy<`__acrt_get_developer_information_policy\'::`2\'::developer_information_policy_properties>(AppPolicyShowDeveloperDiagnostic defaultValue = AppPolicyShowDeveloperDiagnostic_ShowUI (0n1))+0x46 [minkernel\\crts\\ucrt\\src\\appcrt\\internal\\win_policies.cpp @ 44] \r\n1f 050f55d0 7219a20d client_nudge_test_dll!__acrt_get_developer_information_policy(void)+0xc [minkernel\\crts\\ucrt\\src\\appcrt\\internal\\win_policies.cpp @ 146] \r\n20 050f55f0 7219a316 client_nudge_test_dll!common_show_message_box<wchar_t>(wchar_t * text = 0x050f5680 "Debug Assertion Failed!..Program: ã©„æ‘œç‰¥æ­¥æ‘œå±²æ¥§å±´ç•¢æ±©å½¤ã¡¸å¼¶æ‰¤å½§æ•´ç‘³å±³ç•³ç‘©å±¥æ•´ç‘³å±³æ¥¢å±®æ±£æ•©ç‘®æ¸®æ‘µæ•§ç‘Ÿç¥???", wchar_t * caption = 0x721af750 "Microsoft Visual C++ Runtime Library", unsigned int type = 0x12012)+0x6d [minkernel\\crts\\ucrt\\src\\appcrt\\misc\\crtmbox.cpp @ 58] \r\n21 050f5604 7218fe88 client_nudge_test_dll!__acrt_show_wide_message_box(wchar_t * text = 0x050f5680 "Debug Assertion Failed!..Program: ã©„æ‘œç‰¥æ­¥æ‘œå±²æ¥§å±´ç•¢æ±©å½¤ã¡¸å¼¶æ‰¤å½§æ•´ç‘³å±³ç•³ç‘©å±¥æ•´ç‘³å±³æ¥¢å±®æ±£æ•©ç‘®æ¸®æ‘µæ•§ç‘Ÿç¥???", wchar_t * caption = 0x721af750 "Microsoft Visual C++ Runtime Library", unsigned int type = 0x12012)+0x16 [minkernel\\crts\\ucrt\\src\\appcrt\\misc\\crtmbox.cpp @ 93] \r\n22 050f7890 72190112 client_nudge_test_dll!common_message_window<wchar_t>(int report_type = 0n2, void * return_address = 0x72185ced, wchar_t * file_name = 0x721ac100 "minkernel\\crts\\ucrt\\src\\appcrt\\heap\\debug_heap.cpp", wchar_t * line_number = 0x050fa94c "908", wchar_t * module_name = 0x00000000 "", wchar_t * user_message = 0x050f794c "is_block_type_valid(header->_block_use)")+0x488 [minkernel\\crts\\ucrt\\src\\appcrt\\misc\\dbgrpt.cpp @ 409] \r\n23 050f78b0 7219a075 client_nudge_test_dll!__acrt_MessageWindowW(int report_type = 0n2, void * return_address = 0x72185ced, wchar_t * file_name = 0x721ac100 "minkernel\\crts\\ucrt\\src\\appcrt\\heap\\debug_heap.cpp", wchar_t * line_number = 0x050fa94c "908", wchar_t * module_name = 0x00000000 "", wchar_t * user_message = 0x050f794c "is_block_type_valid(header->_block_use)")+0x22 [minkernel\\crts\\ucrt\\src\\appcrt\\misc\\dbgrpt.cpp @ 464] \r\n24 050ff968 721900a4 client_nudge_test_dll!_VCrtDbgReportW(int nRptType = 0n2, void * returnAddress = 0x72185ced, wchar_t * szFile = 0x721ac100 "minkernel\\crts\\ucrt\\src\\appcrt\\heap\\debug_heap.cpp", int nLine = 0n908, wchar_t * szModule = 0x00000000 "", wchar_t * szFormat = 0x721aba48 "%ls", char * arglist = 0x050ff9b0 "")+0x985 [minkernel\\crts\\ucrt\\src\\appcrt\\misc\\dbgrptt.cpp @ 673] \r\n25 050ff994 72185ced client_nudge_test_dll!_CrtDbgReportW(int report_type = 0n2, wchar_t * file_name = 0x721ac100 "minkernel\\crts\\ucrt\\src\\appcrt\\heap\\debug_heap.cpp", int line_number = 0n908, wchar_t * module_name = 0x00000000 "", wchar_t * format = 0x721aba48 "%ls")+0x34 [minkernel\\crts\\ucrt\\src\\appcrt\\misc\\dbgrpt.cpp @ 278] \r\n26 050ff9c0 7218765c client_nudge_test_dll!free_dbg_nolock(void * block = 0x00f366b8, int block_use = 0n2)+0x13d [minkernel\\crts\\ucrt\\src\\appcrt\\heap\\debug_heap.cpp @ 908] \r\n27 050ffa00 72182dcf client_nudge_test_dll!_free_dbg(void * block = 0x00f366b8, int block_use = 0n2)+0x7c [minkernel\\crts\\ucrt\\src\\appcrt\\heap\\debug_heap.cpp @ 1030] \r\n28 050ffa10 72182e2f client_nudge_test_dll!__vcrt_freefls(void * pfd = 0x00f366b8)+0x1f [f:\\dd\\vctools\\crt\\vcruntime\\src\\internal\\per_thread_data.cpp @ 195] \r\n29 050ffa24 7218283a client_nudge_test_dll!__vcrt_freeptd(struct __vcrt_ptd * ptd = 0x00000000)+0x4f [f:\\dd\\vctools\\crt\\vcruntime\\src\\internal\\per_thread_data.cpp @ 186] \r\n2a 050ffa30 7218196d client_nudge_test_dll!__vcrt_thread_detach(void)+0xa [f:\\dd\\vctools\\crt\\vcruntime\\src\\internal\\initialization.cpp @ 117] \r\n2b 050ffa38 7218110c client_nudge_test_dll!__scrt_dllmain_crt_thread_detach(void)+0xd [f:\\dd\\vctools\\crt\\vcstartup\\src\\utility\\utility.cpp @ 455] \r\n2c 050ffa48 7218148b client_nudge_test_dll!dllmain_crt_dispatch(struct HINSTANCE__ * instance = 0x72180000, unsigned long reason = 3, void * reserved = 0x00000000)+0x5c [f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\dll_dllmain.cpp @ 140] \r\n2d 050ffa8c 7218156f client_nudge_test_dll!dllmain_dispatch(struct HINSTANCE__ * instance = 0x72180000, unsigned long reason = 3, void * reserved = 0x00000000)+0x10b [f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\dll_dllmain.cpp @ 211] \r\n2e 050ffaa0 5af974de client_nudge_test_dll!_DllMainCRTStartup(struct HINSTANCE__ * instance = 0x72180000, unsigned long reason = 3, void * reserved = 0x00000000)+0x1f [f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\dll_dllmain.cpp @ 252] \r\n2f 050ffb90 5ae434bd dynamorio!privload_call_entry(struct _dcontext_t * dcontext = 0x1c146d40, struct _privmod_t * privmod = 0x1c0ca950, unsigned int reason = 3)+0x7ee [d:\\derek\\dr\\git\\src\\core\\win32\\loader.c @ 1498] \r\n30 050ffba8 5ae4204c dynamorio!privload_call_entry_if_not_yet(struct _dcontext_t * dcontext = 0x1c146d40, struct _privmod_t * privmod = 0x1c0ca950, int reason = 0n3)+0x7d [d:\\derek\\dr\\git\\src\\core\\loader_shared.c @ 123] \r\n31 050ffbc0 5acad24a dynamorio!loader_thread_exit(struct _dcontext_t * dcontext = 0x1c146d40)+0x5c [d:\\derek\\dr\\git\\src\\core\\loader_shared.c @ 314] \r\n32 050ffc34 5ac9e7ef dynamorio!dynamo_thread_exit_common(struct _dcontext_t * dcontext = 0x1c146d40, unsigned int id = 0x49e0, char detach_stacked_callbacks = 0n0 \'\', char other_thread = 0n0 \'\')+0x3da [d:\\derek\\dr\\git\\src\\core\\dynamo.c @ 2578] \r\n33 050ffc50 5af07c51 dynamorio!dynamo_thread_exit(void)+0x1f [d:\\derek\\dr\\git\\src\\core\\dynamo.c @ 2684] \r\n34 050ffc90 5af22c02 dynamorio!cleanup_and_terminate(void)+0x4d [D:\\derek\\dr\\git\\build_x86_dbg_tests\\core\\CMakeFiles\\dynamorio.dir\\arch\\x86\\x86.asm.obj.s @ 2032] \r\n35 050ffca8 5ae38f89 dynamorio!os_terminate(struct _dcontext_t * dcontext = 0xe82c7400, terminate_flags_t terminate_type = 0n-1494217 (No matching enumerant))+0x12 [d:\\derek\\dr\\git\\src\\core\\win32\\os.c @ 1627] \r\n36 050ffcc8 5ae38e03 dynamorio!nudge_thread_cleanup(struct _dcontext_t * dcontext = 0x1c146d40, char exit_process = 0n0 \'\', unsigned int exit_code = 0)+0x179 [d:\\derek\\dr\\git\\src\\core\\nudge.c @ 185] \r\n37 050ffd30 1c742b7b dynamorio!generic_nudge_handler(struct nudge_arg_t * arg_dont_use = 0x00ef0000)+0x413 [d:\\derek\\dr\\git\\src\\core\\nudge.c @ 275] \r\n0:004> du 50f5680 \r\n050f5680  "Debug Assertion Failed!..Program"\r\n050f56c0  ": ã©„æ‘œç‰¥æ­¥æ‘œå±²æ¥§å±´ç•¢æ±©å½¤ã¡¸å¼¶æ‰¤å½§æ•´ç‘³å±³ç•³ç‘©å±¥æ•´ç‘³å±³æ¥¢å±®æ±£æ•©ç‘®æ¸®"\r\n050f5700  "æ‘µæ•§ç‘Ÿç¥.æ±¤.æ±¤l.File: minkernel\\crts\\u"\r\n050f5740  "crt\\src\\appcrt\\heap\\debug_heap.c"\r\n050f5780  "pp.Line: 908..Expression: is_blo"\r\n050f57c0  "ck_type_valid(header->_block_use"\r\n050f5800  ")..For information on how your p"\r\n050f5840  "rogram can cause an assertion.fa"\r\n050f5880  "ilure, see the Visual C++ docume"\r\n050f58c0  "ntation on asserts...(Press Retr"\r\n050f5900  "y to debug the application)."\r\n```\r\n\r\nShould the nudge thread be calling DllMain routines??  I guess a client\r\nlib\'s nudge handler could depend on static TLS, or call a privlib that\r\ndoes.\r\n\r\nLooks like nudge threads do regular thread init so the DllMain for thread\r\ninit should have been called.  Maybe the problem is we\'ve swapped privlib\r\nstate too early.  Indeed: removing the swap fixes it.', 'state': 'closed', 'created_at': '2020-02-02T04:31:26.000Z', 'updated_at': '2023-03-22T21:22:35.387Z', 'closed_at': None, 'closed_by': None, 'labels': ['Bug-Assert', 'OpSys-Windows'], 'milestone': None, 'assignees': [{'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}], 'author': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'type': 'ISSUE', 'assignee': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'user_notes_count': 0, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/4074', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4074', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4074/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4074/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#4074', 'relative': '#4074', 'full': 'DynamoRIO/dynamorio#4074'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82189, 'iid': 4060, 'project_id': 160, 'title': 'Switch raw2trace from a per-instr hashtable to a per-block hashtable', 'description': "For #3977 I changed raw2trace to store per-instruction data with the block start PC as part of the key, to handle duplicated instructions in multiple blocks.  However, raw2trace was still doing a hashtable lookup on an individual instruction basis, and that table lookup took 10% of cpu time (with i/o disabled).  Plus, when using the best C++ STL table, that lookup rose to 28% of the time (see #2056 for the initial measurements; I re-measured with the new block,instr keys), and in fact showed a significant slowdown:\r\n\r\nhashtable_t in HEAD:\r\n```\r\n6.39user 0.09system 0:06.49elapsed 99%CPU (0avgtext+0avgdata 10964maxresident)k\r\n6.33user 0.07system 0:06.41elapsed 99%CPU (0avgtext+0avgdata 10964maxresident)k\r\n6.45user 0.06system 0:06.57elapsed 99%CPU (0avgtext+0avgdata 10904maxresident)k\r\n```\r\n\r\nc++11 std::unordered_map.find, max_load_factor 0.5, init size 1<<16, custom hash+cmp:\r\n```\r\n7.61user 0.09system 0:07.71elapsed 99%CPU (0avgtext+0avgdata 11360maxresident)k\r\n7.51user 0.04system 0:07.55elapsed 99%CPU (0avgtext+0avgdata 11516maxresident)k\r\n7.44user 0.07system 0:07.60elapsed 99%CPU (0avgtext+0avgdata 11428maxresident)k\r\n```\r\n\r\nAs part of #3316 I'm trying to remove all reliance on the full DR library from raw2trace.  The use of the drcontainers hashtable_t is one such reliance.  Since it would be rather hacky to try and make a version of drcontainers with no DR dependencies (it has persistence support and uses DR locks), instead I'm proposing refactoring the raw2trace hashtables to store per-block info, query per block, remember the last block, and store per-instr info in a vector inside the block.  We do have access to the instr count and instr index for all callers, if we store the index in a note for the elision walk.\r\n\r\nI implemented this and the speedup is nice (remember this is w/o i/o):\r\n```\r\n5.22user 0.11system 0:05.34elapsed 99%CPU (0avgtext+0avgdata 10728maxresident)k\r\n5.21user 0.05system 0:05.27elapsed 99%CPU (0avgtext+0avgdata 10704maxresident)k\r\n5.30user 0.06system 0:05.37elapsed 99%CPU (0avgtext+0avgdata 10664maxresident)k\r\n```\r\nThe time spent in hashtable_lookup is now 0.95%.  So we should be able to swap to the C++ table without noticeable overhead, making it easier to move raw2trace to use drdecode.", 'state': 'closed', 'created_at': '2020-01-27T20:03:23.000Z', 'updated_at': '2023-03-22T21:22:33.245Z', 'closed_at': None, 'closed_by': None, 'labels': ['Component-DrCacheSim', 'Performance'], 'milestone': None, 'assignees': [{'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}], 'author': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'type': 'ISSUE', 'assignee': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'user_notes_count': 1, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/4060', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4060', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4060/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4060/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#4060', 'relative': '#4060', 'full': 'DynamoRIO/dynamorio#4060'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82184, 'iid': 4052, 'project_id': 160, 'title': 'CRASH due to uninitialized static TLS for static DR on Windows', 'description': "After fixing #4030, the static-DR apps using droption (drcachesim offline) are crashing under VS2017.  Their static TLS is not set up and TEB.ThreadLocalStoragePointer is NULL.\r\n\r\nIn #2117 we turned off -private_loader for UNIX, but on Windows we have it.  Pasting from that issue:\r\n\r\n  Unlike on Linux, on Windows we don't rely on private libs filling in key\r\n  TLS pieces for us and we have a less-significant swap. Furthermore, we\r\n  have a much heavier dependence on -private_loader and -private_peb\r\n  throughout DR API code. Plus, at least partial library isolation is\r\n  possible due to the inability to link in static WINAPI libs. Thus, it\r\n  seems like we should leave it on for Windows.\r\n\r\nThat makes sense.  So I guess we try to leave it on, and we run the i#4030\r\ncode on the executable for static DR?  Basically running it twice and\r\nhoping there are no bad consequences from that??  Or, better to just copy\r\nthe app TLS data and not call the initializers?\r\n", 'state': 'closed', 'created_at': '2020-01-25T19:44:31.000Z', 'updated_at': '2023-03-22T21:22:25.203Z', 'closed_at': None, 'closed_by': None, 'labels': ['Bug-DRCrash', 'Component-DrCacheSim', 'OpSys-Windows'], 'milestone': None, 'assignees': [{'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}], 'author': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'type': 'ISSUE', 'assignee': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'user_notes_count': 0, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/4052', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4052', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4052/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4052/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#4052', 'relative': '#4052', 'full': 'DynamoRIO/dynamorio#4052'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82183, 'iid': 4050, 'project_id': 160, 'title': 'Build race with API headers on Appveyor', 'description': "Recently I've seen this a few times on Appveyor:\r\nhttps://ci.appveyor.com/project/DynamoRIO/dynamorio/builds/30344395\r\n```\r\n13686====> FAILURE in debug-internal-64 <====\r\n13687debug-internal-64: **** 1 build errors ****\r\n13688\tC:\\projects\\dynamorio\\build\\build_debug-internal-64\\include\\dr_api.h(47) : fatal error C1083: Cannot open include file: 'dr_defines.h': No such file or directory\r\n13689final package: **** 85 build errors ****\r\n13690\tntdll_imports_x64.def : error LNK2001: unresolved external symbol __isascii\r\n13691\tntdll_imports_x64.def : error LNK2001: unresolved external symbol __iscsym\r\n13692\tntdll_imports_x64.def : error LNK2001: unresolved external symbol __iscsymf\r\n13693\tntdll_imports_x64.def : error LNK2001: unresolved external symbol __toascii\r\n13694\tntdll_imports_x64.def : error LNK2001: unresolved external symbol _atoi64\r\n```\r\n\r\nA re-build makes it go away.  I think it's a race introduced recently -- and my theory is drdisas is missing a dependence.  I will fix it.", 'state': 'closed', 'created_at': '2020-01-25T02:59:26.000Z', 'updated_at': '2023-03-22T21:22:24.872Z', 'closed_at': None, 'closed_by': None, 'labels': ['Component-Build', 'Hotlist-ContinuousIntegration', 'OpSys-Windows'], 'milestone': None, 'assignees': [{'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}], 'author': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'type': 'ISSUE', 'assignee': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'user_notes_count': 0, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/4050', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4050', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4050/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/4050/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#4050', 'relative': '#4050', 'full': 'DynamoRIO/dynamorio#4050'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82149, 'iid': 3982, 'project_id': 160, 'title': 'CRASH static app writing to errno with emulated brk', 'description': 'Xref #1004 where this exact thing happened with the original brk due to DR\'s mmaps happening to be placed next to the real break.  Here we have seen a similar case but it is with the emulated break.\r\n\r\nAn early call to brk() fails because a tracing tool library (libdrsyms.so) was loaded by the kernel right next to the emulated break managed by DR.\xa0 The brk() code then enters an error path which writes to errno located at an offset from %fs, but this is so early (~220 blocks in) that the %fs segment has not been set up yet (that\'s at ~260 blocks), so the brk() code crashes.\r\n\r\n```\r\nprivload_load_finalize: loaded libdrsyms.so @ 0x00000000009c1000-0x0000000000c0f000 from /.../libdrsyms.so\r\n\r\nemulate_app_brk: cur=0x00000000009c0000, requested=0x00000000009c2a00\r\nemulate_app_brk: mremap to 0x00000000009c3000 failed\r\n```\r\n\r\nMany tool libraries have preferred bases set to place them in certain locations, but libdrsyms.so and libdrmemtrace.so did not set custom bases and have the same default preferred, so the 2nd one (libdrsyms) ends up wherever the kernel places it.\xa0\xa0\r\n\r\nGeneral heap allocation has to handle brk() failing, so this could be viewed as an application bug.\xa0 However, this is in some very early bootstrapping code, so probably the authors do not expect failure and never tested this error path.\r\n\r\nWe could try "-no_emulate_brk" as a workaround, which may or may not work depending again on where some mmaps fall: it might hit #1004.\r\n\r\nFor a better solution, should we reserve a big region in our emulated break location as no-access to block other mmaps, and use MAP_FIXED to extend the break?', 'state': 'closed', 'created_at': '2019-12-12T18:54:14.000Z', 'updated_at': '2023-03-22T21:21:18.092Z', 'closed_at': None, 'closed_by': None, 'labels': ['Bug-AppCrash', 'OpSys-Linux'], 'milestone': None, 'assignees': [{'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}], 'author': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'type': 'ISSUE', 'assignee': {'id': 2188, 'username': 'derekbruening', 'name': 'Derek Bruening', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/8a72183cf37fb73362ea79f825217a28?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/derekbruening'}, 'user_notes_count': 0, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/3982', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/3982', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/3982/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/3982/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#3982', 'relative': '#3982', 'full': 'DynamoRIO/dynamorio#3982'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}, {'id': 82087, 'iid': 3850, 'project_id': 160, 'title': 'Private loader doing depth-first search while native is doing breadth-first.', 'description': 'See title. In certain situations, the private loader may fail to find client library dependencies. Here is an example how to reproduce:\r\n\r\n**lib_test/randomdir/lib2.c**\r\n```\r\ncat lib2.c \r\nint lib2func() { return 2; }\r\n```\r\n**lib_test/randomdir/lib3.c**\r\n```\r\ncat lib3.c\r\nint lib3func() { return 3; }\r\n```\r\n**lib_test/lib1.c**\r\n```\r\ncat lib1.c\r\n#define LINUX\r\n#define X86_64\r\n#include "dr_api.h"\r\nDR_EXPORT void dr_init(client_id_t id) {}\r\n```\r\n\r\n**Compile and construct dependencies in lib_test/randomdir/:**\r\n```\r\ngcc -o libno3.so -shared lib3.c\r\ngcc -o libno2.so -shared -lno3 -L. lib2.c\r\n```\r\n\r\n**Compile client and construct dependencies in lib_test/:**\r\n```\r\ngcc -o libno1.so -shared -Lrandomdir/ -I../dynamorio/build/include -Wl,-rpath=/usr/local/google/home/hgreving/lib_test/randomdir/ -lno2 -lno3 lib1.c\r\n```\r\n\r\n**Now run in lib_test/:**\r\n```\r\n../dynamorio/build/bin64/drrun -debug -code_api -c libno1.so -- echo Hello World\r\n```\r\n\r\n**Leads to error:**\r\n```\r\nUnable to load client library: libno3.so\r\n        Unable to locate library! Try adding path to LD_LIBRARY_PATH.>\r\n```\r\n\r\nThe reason for this is that the private loader follows libno2.so\'s dependency on libno3.so, but libno2.so is missing an rpath to search for it, see above compile cmds. Both adding randomdir to LD_LIBRARY_PATH or rpath to libno2.so works fine. Also the client lib\'s path is added to the search path, so it works if libno2 and libno3 are in the same path as libno1.\r\n\r\nI have not added an example for the native loader here, but doing the same natively, the libraries are found. Using strace you can tell that the libraries are opened in breadth-first order by the loader, so the native loader sees the rpath in libno1, finding libno3.\r\n\r\n\r\n\r\n', 'state': 'opened', 'created_at': '2019-09-24T16:47:18.000Z', 'updated_at': '2023-03-22T21:21:05.766Z', 'closed_at': None, 'closed_by': None, 'labels': ['Bug-DRCrash', 'OpSys-Linux', 'OpSys-UNIX'], 'milestone': None, 'assignees': [{'id': 2206, 'username': 'hgreving2304', 'name': 'Hendrik Greving', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/6d53ffbf58ee635d82eac3cd49da777b?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/hgreving2304'}], 'author': {'id': 2206, 'username': 'hgreving2304', 'name': 'Hendrik Greving', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/6d53ffbf58ee635d82eac3cd49da777b?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/hgreving2304'}, 'type': 'ISSUE', 'assignee': {'id': 2206, 'username': 'hgreving2304', 'name': 'Hendrik Greving', 'state': 'active', 'avatar_url': 'https://www.gravatar.com/avatar/6d53ffbf58ee635d82eac3cd49da777b?s=80&d=identicon', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/hgreving2304'}, 'user_notes_count': 3, 'merge_requests_count': 0, 'upvotes': 0, 'downvotes': 0, 'due_date': None, 'confidential': False, 'discussion_locked': None, 'issue_type': 'issue', 'web_url': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/DynamoRIO/dynamorio/-/issues/3850', 'time_stats': {'time_estimate': 0, 'total_time_spent': 0, 'human_time_estimate': None, 'human_total_time_spent': None}, 'task_completion_status': {'count': 0, 'completed_count': 0}, 'has_tasks': False, '_links': {'self': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/3850', 'notes': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/3850/notes', 'award_emoji': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160/issues/3850/award_emoji', 'project': 'http://ec2-3-129-135-45.us-east-2.compute.amazonaws.com:8023/api/v4/projects/160', 'closed_as_duplicate_of': None}, 'references': {'short': '#3850', 'relative': '#3850', 'full': 'DynamoRIO/dynamorio#3850'}, 'severity': 'UNKNOWN', 'moved_to_id': None, 'service_desk_reply_to': None}]


Step 9:
act - AgentFinishAction(outputs={}, thought='Based on the full response, the latest updated issue with the keyword "dependency" in its title is titled "Outdated dependencies" and is currently in the "opened" state. Therefore, it is not closed.\n\nFinish[The latest updated issue with the keyword "dependency" in its title is not closed; it is currently in the "opened" state.]', action='finish')
obs - NullObservation(content='', observation='null')

